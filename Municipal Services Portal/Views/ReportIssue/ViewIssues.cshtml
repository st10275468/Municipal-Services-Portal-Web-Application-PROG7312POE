@model Municipal_Services_Portal.Models.Issue[]

@{
    
    var categories = Model?.Select(i => i.Category).Distinct().ToList() ?? new List<string>();
}

<div class="display-section">
    <div class="container">
    <div class="reportHero-text">
        <h1>Reported Issues</h1>
        <p>View all issues efficiently</p>
    </div>
        <!--Filter enabling user to filter through issues by category-->
    <div class="issues-filter">
        <input type="text" id="searchInput" placeholder="Search by description..." onkeyup="filterIssues()" />
        <select id="categorySelect" onchange="filterIssues()">
            <option value="">All Categories</option>
            @foreach (var category in categories)
            {
                <option value="@category">@category</option>
            }
        </select>
    </div>
        <!--Displaying issues to the user in card format-->
    <div class="issues-grid" id="issuesGrid">
        @if (Model == null || !Model.Any())
        {
            <div class="no-issues">No issues have been reported yet.</div>
        }
        else
        {
            @foreach (var issue in Model)
            {
                <div class="issue-card" data-category="@issue.Category" data-description="@issue.Description.ToLower()">
                    <h5>@issue.Category</h5>
                    <p class="location">@issue.Location</p>
                    <p class="description">@issue.Description</p>
                    <p class="date"><strong>Submitted:</strong> @issue.DateSubmitted.ToString("dd MMM yyyy HH:mm")</p>
                    <p class="status">
                            <span class="badge @(issue.Status == "Pending" ? "pending" : issue.Status == "In Progress" ? "inprogress" : "resolved")">@issue.Status</span>
                    </p>
                    @if (!string.IsNullOrEmpty(issue.MediaPath))
                    {
                        <a href="@issue.MediaPath" target="_blank" class="btn-">View Attachment</a>
                    }
                </div>
            }
        }
    </div>
    </div>
</div>

<script>
    function filterIssues() {
        var input = document.getElementById('searchInput').value.toLowerCase();
        var category = document.getElementById('categorySelect').value;
        var cards = document.querySelectorAll('.issue-card');

        cards.forEach(card => {
            var matchesCategory = !category || card.dataset.category === category;
            var matchesSearch = !input || card.dataset.description.includes(input);
            card.style.display = (matchesCategory && matchesSearch) ? 'flex' : 'none';
        });
    }
</script>
